<!DOCTYPE html>
<html>
  <head>
  <title>French Test</title>
  <script type = "text/javascript" src="jquery-3.6.0.js"></script>
  <script id = 'stimuli'></script>
  <script>
  var stable = "stimuli.js?="
  var dynamic = Date.now()
  var parent = document.getElementById("stimuli")
  var someScriptElement = document.createElement("script")
  someScriptElement.setAttribute("src", stable + dynamic)
  stimuli.appendChild(someScriptElement)
  </script>
  <script id = "helper"></script>
  <script>
    // force reload of stimuli pages (for development.)
    var stable = "helper_functions.js?="
    var dynamic = Date.now()
    var parent = document.getElementById("helper")
    var someScriptElement = document.createElement("script")
    someScriptElement.setAttribute("src", stable + dynamic)
    helper.appendChild(someScriptElement)
    </script>
  <script src = "jspsych/jspsych.js"></script>
  <script src = "jspsych/plugin-html-keyboard-response.js"></script>
  <script src = "jspsych/plugin-initialize-microphone.js"></script>
  <script src = "jspsych/plugin-html-audio-response.js"></script>
  <script src = "jspsych/plugin-audio-keyboard-response.js"></script>
  <script src = "jspsych/plugin-audio-button-response.js"></script>
  <script src = "jspsych/plugin-html-button-response.js"></script>
  <script src = "jspsych/plugin-image-button-response.js"></script>
  <script src = "jspsych/plugin-image-keyboard-response.js"></script>
  <script src = "jspsych/plugin-survey-multi-select1.js"></script>
  <script src = "jspsych/plugin-survey-multi-choice1.js"></script>
  <script src = "jspsych/plugin-survey-html-form.js"></script>
  <script src = "jspsych/plugin-survey-html-form-timeout5.js"></script>
  <script src = "jspsych/plugin-instructions.js"></script>
  <script src = "jspsych/plugin-cloze19.js"></script>
  <script src = "jspsych/plugin-survey-text.js"></script>
  <script src="jspsych/plugin-preload.js"></script>
  <link href = "jspsych/jspsych.css" rel="stylesheet" type = "text/css" />
  <script src = 'stimuli.js' type = 'text/javascript'></script>   
  </head>
  <body></body>  
  <script>
  const jsPsych = initJsPsych({
    on_finish: function(data){
      jsPsych.data.displayData();
     // console.log('finished')
      // save data to csv
      saveData(jsPsych.data.get().select('subject').values[0].Q0, jsPsych.data.get().csv())
     // window.location = "https://www.duolingo.com";
    }
  });
  </script>
</html>

<script>
/*version A
- need to create separate data folders for versions A and B, or otherwise figure out how to sort this properly. 

*/
const test_version = 'A'
const timeline = []

/* reuse this countdown variable throughout*/
const countdown321 =  {
  // simulate a countdown for recording to start
  type: jsPsychHtmlKeyboardResponse,
  choices: 'NO_KEYS',
  trial_duration: 1050,
  timeline: [
    {stimulus: 'Begin speaking your answer in 3...'},
    {stimulus: 'Begin speaking your answer in 2...'},
    {stimulus: 'Begin speaking your answer in 1...'}
  ]}


// will be changed to get from URL variable, and also concat it to the test version. 
var get_subject = {
  type: jsPsychSurveyText,
  questions: [{prompt: 'Please enter subject id'}],
  on_finish: function(data){
    jsPsych.data.addProperties({subject: data.response})
    console.log(jsPsych.data.get().select('subject').values[0].Q0)
    //jsPsych.data.get().select('subject')[0].values[0].Q0
  }
}
timeline.push(get_subject)

/* activate microphone and ensure participants can hear themselves being recorded.  */

// explain microphone connection
const prepare_microphone = {
    type: jsPsychHtmlButtonResponse,
    stimulus: 'Please connect your microphone to the computer. <br> We recommend using a pair of headphones with a microphone. <br>Once you have connected your microphone & headphones to the computer, click this button to prompt browser access to your microphone',
    choices: ['Add Microphone'],
}
//timeline.push(prepare_microphone)

// prompt for permission and initialise microphone
const ready_microphone = {
    type: jsPsychInitializeMicrophone
}
timeline.push(ready_microphone)

// explain to participants they need to make sure they can hear themselves. 
const test_audio_instructions = {
  type: jsPsychHtmlButtonResponse,
  stimulus: 'Let\'s make sure the test can hear you. Please click the button below and speak into your microphone for a few seconds. <br> Afterwards, you will be able to play your recording. <br>Please make sure that you can hear your recording. If not, please make sure you microphone is working properly and try again. <br> Please do not continue the test until you are able to hear a recording of yourself played back to you.',
  choices: ['Begin Recording']
}
//timeline.push(test_audio_instructions)

// allow recording and playback, recording limited to 10 seconds. 
const test_audio = {
  type: jsPsychHtmlAudioResponse,
    recording_duration: 10000,
    stimulus: 'RECORDING...',
    allow_playback: true,
    show_done_button: true,
    record_again_button_label: 'Record Again',
    on_finish: function(data){
      data.response = 'sanitized'}
}
//timeline.push(test_audio)

// honor system - participants will click to move on. 
const recording_passed = {
    type: jsPsychHtmlButtonResponse,
    stimulus: 'Thank you. You have indicated that you are able to hear yourself in the recording. <br> Press Continue when you are ready to continue the test.',
    choices: ['Continue'],
}
//timeline.push(recording_passed);

/***** STORY COMPLETION BLOCK *********
These questions involve participants looking at a series of images with which they will base a story. The images will be displayed for a fixed period of time (30 seconds), after which participants will have 2 minutes to orally tell their story based on the pictures. 
*/

/* Story Completion Part 1 - single image of a park
- 1 minute to prepare
- 4 minutes for response
*/

var SC_task_instructions = {
  type: jsPsychInstructions,
  pages: ['<b>Speaking Tasks</b>',
  'In this next part, you will complete speaking tasks.',
  'For each task, you must use complete sentences.',
  'However, since you\'re in the process of learning French, you can substitute some French words in English, but only if you don\'t know them.',
  'We look forward to hearing your stories!',
  'Click "Next" to continue to the first speaking task.'],
  show_clickable_nav: true
}

//timeline.push(SC_task_instructions)

var SC1_preload = {
  type: jsPsychPreload,
  images: 'image/PD_1.jpg'
}
//timeline.push(SC1_preload)

var SC1_instructions = {
type: jsPsychInstructions,
pages: ['<b>Picture description task</b>',
'Objective: <b>Describe the people and the activities the people are doing</b>.',
'You will see an image with many people, doing many activities.',
'You have 1 minute to study the image and 4 minutes to describe what is happening in the image.',
'You can focus on <ul style = "text-align: left"><li>Activities</li><li>People: clothing (color, types), physical traits, likes/dislikes</li><li>Objects (food, vehicles), and their location on the image</li><li>Weather</li></ul>',
  'Use complete sentences as much as possible.',
  'If you cannot make a complete sentence, provide a list of vocabulary words to describe the scene.'],
show_clickable_nav: true
}

//timeline.push(SC1_instructions)

var SC1_trials = {
  timeline: [
    {type: jsPsychHtmlButtonResponse,
    stimulus: 'Once you click this button, you will have 1 minute to study the picture and prepare your response.<br>',
    choices: ["See Picture"]},

    {type: jsPsychImageButtonResponse,
      stimulus: 'image/PD_1.jpg',
      trial_duration: 60500, // should be 1 minute (60000 ms), add 500 ms as buffer
      stimulus_height: 400,
      stimulus_width: 600,
      prompt: '<br><p style = "text-align: left">Remember to describe:</p><ul style = "text-align: left; font-size: 12"><li>People: clothing (color, types), physical traits, likes/dislikes</li><li>Objects (food, vehicles), and their location on the image</li><li>Activities</li><li>Weather</li></ul>',
      on_finish: function(data){
        data.stim_id = 'PD_1'
      },
      choices: ["I'm Ready"]
    },

    // 3 second countdown
    countdown321,

  // record answer 
  {
    type: jsPsychHtmlAudioResponse,
    stimulus: 'RECORDING...',
    recording_duration: 241000, // trial duration should be 4 minutes (240000ms), add 1000ms as a buffer
    show_done_button: true,
    done_button_label: "Finish Recording",
    // save audio
    on_finish: function(data){
        data.stim_id = 'PD_1';
        //subject name
      purgeAudio(jsPsych.data.get().select('subject').values[0].Q0,
      // audio file name
      jsPsych.data.get().last(5).values()[0].stimulus.substring(6), 
      // current js data object
      data),
      console.log(jsPsych.data.get().last(5).values()[0].stimulus.substring(6))
}}
  ]
}
//timeline.push(SC1_trials)

/* Story Completion Part 2 - six-panel images making a story
- 30 seconds to prepare
- 2 minutes for response
- size images to be w600xh800
- 1 trial so no need for timeline variables. 
*/

var SC2_preload = {
  type: jsPsychPreload,
  images: 'image/narrative_marcus.png'
}

timeline.push(SC2_preload)

var SC2_instructions = {
  type: jsPsychInstructions,
  pages: ['<b>Picture Narration Task</b>',
  'Objective: <b>Tell the story with as many interesting details as you can.</b>',
  'You will see six images.',
  'Your task is to create an original story using the pictures to inspire your story.',
  'Provide additional details based on your imagination to make the story more interesting. ',
  'You have 30 seconds to plan your story and 3 minutes to tell your story.',
  ' If you forget some words, you can use English.'
],
  show_clickable_nav: true
}
//timeline.push(SC2_instructions)

var SC2_trials = {
  timeline: [
    {type: jsPsychHtmlButtonResponse,
    stimulus: 'Once you click this button, you will have 30 seconds to study the picture and prepare your response',
    choices: ["See Picture"]},

    {type: jsPsychImageButtonResponse,
      stimulus: 'image/narrative_marcus.png',
      trial_duration: 310000, // should be 30 seconds (30,000 ms), add 1000 ms as buffer
      stimulus_height: 600,
      stimulus_width: 400,
      on_finish: function(data){
        data.stim_id = 'narrative_marcus'},
      choices: ["I'm Ready"]
    },

    // 3 second countdown
    countdown321,

    // record answer 
  {
    type: jsPsychHtmlAudioResponse,
    stimulus: 'RECORDING...',
    recording_duration: 180500, // trial duration should be 3 minutes (180000ms), add 500ms as a buffer
    show_done_button: true,
    done_button_label: "Finish Recording",
    // save audio
    on_finish: function(data){
        data.stim_id = 'narrative_marcus';
        //subject name
      purgeAudio(jsPsych.data.get().select('subject').values[0].Q0,
      // audio file name
      jsPsych.data.get().last(5).values()[0].stimulus.substring(6), 
      // current js data object
      data),
      console.log(jsPsych.data.get().last(5).values()[0].stimulus.substring(6))
}}
  ]
}
//timeline.push(SC2_trials)

/* Story Completion Part 3 - story of Max: before, now, and after.
- 1 minute to prepare
- 5 minutes to record
*/

var SC3_preload = {
  type: jsPsychPreload,
  images: 'image/samantha1.png'
}
timeline.push(SC3_preload)

var SC3_instructions = {
  type: jsPsychInstructions,
  pages: ['<b>Picture Description Task</b>',
  'Objective: <b>Tell Samantha\'s Story!',
    'You will see one image.',
    'Your task is to tell us what you think happened to Samantha ONE hour ago...',
    '...what is happening to Samantha NOW...',
    '...and what will happen NEXT.',
    'You will have one minute to plan and five minutes to record your story.',
    'You story <b>must</b> include: <ol style = "text-align: left"><li>what happened one hour ago</li><li>what is happening now</li><li>what will happen next</li></ol>'],
  show_clickable_nav: true
}

//timeline.push(SC3_instructions);

var SC3_trials = {
  timeline: [
    {type: jsPsychHtmlButtonResponse,
    stimulus: 'Once you click this button, you will have one minute to study the picture and prepare your response',
    choices: ["See Picture"]},

    {type: jsPsychImageButtonResponse,
      stimulus: 'image/samantha1.png',
      trial_duration: 61000, // should be 1 minute (60,000 ms), add 1000 ms as buffer
      stimulus_height: 600,
      stimulus_width: 800,
      choices: ["I'm Ready"],
      on_finish: function(data){
        data.stim_id = 'samantha'
      }
    },
    // 3 second countdown
    countdown321,
  {
    type: jsPsychHtmlAudioResponse,
    stimulus: 'RECORDING...',
    recording_duration: 301000, // trial duration should be 5 minutes (300000ms), add 1000ms as a buffer
    show_done_button: true,
    done_button_label: "Finish Recording",
    // save audio
    on_finish: function(data){
      data.stim_id = 'samantha';
      //subject name
      purgeAudio(jsPsych.data.get().select('subject').values[0].Q0,
      // audio file name
      jsPsych.data.get().last(5).values()[0].stimulus.substring(6), 
      // current js data object
      data),
    console.log(jsPsych.data.get().last(5).values()[0].stimulus.substring(6))
}}
  ]
}

//timeline.push(SC3_trials)

/* Story Completion Part 4 - unrelated picture story.
- 60 seconds to prepare
- 5 minutes for response
- PRE/POST: same
*/

var SC4_preload = {
  type: jsPsychPreload,
  images: 'image/unrelated.png'
}
timeline.push(SC4_preload)

var SC4_instructions = {
  type: jsPsychInstructions,
  pages: ['<b>Unrelated Picture Narration Task</b>',
  'You will see 4 images that are not related.',
  'You <b>must create a story</b> based on these images.',
  'The order of the images is not important.',
  'Feel free to add characters!',
  'There are no right or wrong stories, just let these four images inspire you.'],
  show_clickable_nav: true
}
// timeline.push(SC4_instructions);

var SC4_trials = {
  timeline: [
    {type: jsPsychHtmlButtonResponse,
    stimulus: 'Once you click this button, you will have 60 seconds to study the picture and prepare your response',
    choices: ["See Picture"]},

    {type: jsPsychImageButtonResponse,
      stimulus: 'image/unrelated.png',
      trial_duration: 61000, // should be 60 seconds (60,000 ms), add 1000 ms as buffer
      stimulus_height: 500,
      stimulus_width: 700,
      on_finish: function(data){
        data.stim_id = 'unrelated'},
      choices: ["I'm Ready"]
    },

    // 3 second countdown
    countdown321,
  {
    type: jsPsychHtmlAudioResponse,
    stimulus: 'RECORDING...',
    recording_duration: 5000, // trial duration should be 2 minutes (120000ms), add 500ms as a buffer
    show_done_button: true,
    done_button_label: "Finish Recording",
    // save audio
    on_finish: function(data){
      data.stim_id = 'unrelated';
      //subject name
      purgeAudio(jsPsych.data.get().select('subject').values[0].Q0,
      // audio file name
      jsPsych.data.get().last(5).values()[0].stimulus.substring(6), 
      // current js data object
      data),
    console.log(jsPsych.data.get().last(5).values()[0].stimulus.substring(6))
}}
  ]
}

//timeline.push(SC4_trials)


/***** COMMUNICATIVE ADEQUACY BLOCK *********
These questions involve participants listening and responding to a sustained simulated conversation. They will listen to the recording and then be asked to record their response. They will only be able to listen to each turn once. 
- do we need a practice session? or at least one practice item to start? 
*/

var CA_timeline_stimuli = [
  {scenario: 'You are sick and calling the health clinic to make an appointment with your doctor.<br>The new receptionist is very busy learning her new tasks.<br><br>Start the conversation by:<br>1. Greeting the receptionist<br>2. Requesting an appointment for tomorrow.<br><br>', turn1: 'audio/1_infirmiere1.mp3', turn2: 'audio/1_infirmiere2.mp3', turn3: 'audio/1_infirmiere3.mp3', data: {stim_id: 'DCT1'}},

  {scenario: 'You need a ride to school for your exam. The exam is Tuesday at 9h.<br>You call your friend to <b>ask for a ride</b>. Your friend is very tired because he started a new job.<br><br> Start the conversation by:<br>1. Greeting your friend<br>2. Requesting a ride for Tuesday at 9h.<br><br>', turn1: 'audio/2_auto1.mp3', turn2: 'audio/2_auto2.mp3', turn3: 'audio/2_auto3.mp3', data: {stim_id: 'DCT2'}},

  {scenario: '', turn1: '', turn2: '', turn3: '', data:{stim_id: ''}}


];

var CA_audio = ['audio/1_infirmiere1.mp3', 'audio/1_infirmiere2.mp3', 'audio/1_infirmiere3.mp3', 'audio/2_auto1.mp3', 'audio/2_auto2.mp3', 'audio/2_auto3.mp3', 'audio/3_cours1.mp3', 'audio/3_course2.mp3', 'audio/3_cours3.mp3', 'audio/4_gateau1.mpr', 'audio/4_gateau2.mp3', 'audio/4_gateau3.mp3', 'audio/5_retard1.mp3', 'audio/5_retard2.mp3', 'audio/5_retard3.mp3', 
'audio/cle1.mp3', 'audio/cle2.mp3', 'audio/cle3.mp3', 'audio/7_collegue1.mpr', 'audio/7_collegue2.mp3', 'audio/7_collegue3.mp3', 'audio/8_invitation_we1.mp3', 'audio/8_invitation_we2.mp3', 'audio/8_invitation_we3.mp3']

var CA_preload = 
{type: jsPsychPreload,
  audio: CA_audio,
  message: "Loading audio, please wait..."
}
timeline.push(CA_preload)


// instructions for communicative adequacy
const CA_instructions = {
  type: jsPsychInstructions,
  pages: ['<b>Discourse Completion Task<b>',
    'Carefully read the scenario, written in English.',
    'You will then participate in a short dialogue with the computer.',
    'You will begin by starting the conversation - be sure to address the topic provided!',
    'After you record your answer, you will hear a response, <strike>followed by your recording.</strike>',
    'For each question, you will make three short recordings.',
    'Use complete sentences.',
    'Use as much French as possible.'],
  show_clickable_nav: true,
}

timeline.push(CA_instructions)

// communicative adequacy timeline. 
const CA_trials = {
  timeline: [
  {type: jsPsychHtmlButtonResponse,
  stimulus: 'You are about to begin a NEW conversation.',
  choices: ['BEGIN']},

{
  type: jsPsychHtmlButtonResponse,
  stimulus: jsPsych.timelineVariable('scenario'),
  choices: ['Start your conversation...']
},

  // 3 second countdown
  countdown321,

  // record conversation opening
  {
    type: jsPsychHtmlAudioResponse,
    stimulus: 'RECORDING...',
    recording_duration: 5000, // limit to ? how long? 
    show_done_button: true,
    data: jsPsych.timelineVariable("data"),
    done_button_label: "Finish Recording",
    // save audio
    on_finish: function(data){
        //subject name
      purgeAudio(jsPsych.data.get().select('subject').values[0].Q0,
      // audio file name
      'conversation_opening', 
      data)
}},

{
  type: jsPsychHtmlKeyboardResponse,
  stimulus: 'Their response is...',
  trial_duration: 2000
},

{
  type: jsPsychAudioKeyboardResponse,
  stimulus: jsPsych.timelineVariable('turn1'),
  data: jsPsych.timelineVariable("data"),
  choices: 'NO_KEYS',
  trial_ends_after_audio: true
},

  // 3 second countdown
  countdown321,

  // record answer to first turn.
    {
    type: jsPsychHtmlAudioResponse,
    stimulus: 'RECORDING...',
    recording_duration: 5000, // limit to ? how long? 
    show_done_button: true,
    data: jsPsych.timelineVariable("data"),
    done_button_label: "Finish Recording",
    // save audio
    on_finish: function(data){
        //subject name
      purgeAudio(jsPsych.data.get().select('subject').values[0].Q0,
      // audio file name
      jsPsych.data.get().last(5).values()[0].stimulus.substring(6), 
      // current js data object
      data)
}},
    
{
  type: jsPsychHtmlKeyboardResponse,
  stimulus: 'Their response is...',
  trial_duration: 2000
},

{
    type: jsPsychAudioKeyboardResponse,
  stimulus: jsPsych.timelineVariable('turn2'),
  data: jsPsych.timelineVariable("data"),
  choices: 'NO_KEYS',
  trial_ends_after_audio: true
},
  // 3 second countdown
  countdown321,

   // record answer trial to second turn
   {
    type: jsPsychHtmlAudioResponse,
    stimulus: 'RECORDING...',
    recording_duration: 5000, // limit to ? how long? 
    show_done_button: true,
    data: jsPsych.timelineVariable("data"),
    done_button_label: "Finish Recording",
    // save audio
    on_finish: function(data){
        //subject name
      purgeAudio(jsPsych.data.get().select('subject').values[0].Q0,
      // audio file name
      jsPsych.data.get().last(5).values()[0].stimulus.substring(6), 
      // current js data object
      data)
}},

{
  type: jsPsychHtmlKeyboardResponse,
  stimulus: 'Their response is...',
  trial_duration: 2000
},

  {type: jsPsychAudioKeyboardResponse,
  stimulus: jsPsych.timelineVariable('turn3'),
  data: jsPsych.timelineVariable("data"),
  choices: 'NO_KEYS',
  trial_ends_after_audio: true},

  // 3 second countdown
  countdown321,

     // record answer to third turn
     {
    type: jsPsychHtmlAudioResponse,
    stimulus: 'RECORDING...',
    recording_duration: 5000, // limit to ? how long? 
    show_done_button: true,
    data: jsPsych.timelineVariable("data"),
    done_button_label: "Finish Recording",
    // save audio
    on_finish: function(data){
        //subject name
      purgeAudio(jsPsych.data.get().select('subject').values[0].Q0,
      // audio file name
      jsPsych.data.get().last(5).values()[0].stimulus.substring(6), 
      // current js data object
      data)
}},

  {type: jsPsychHtmlKeyboardResponse,
  stimulus: "LOADING NEXT CONVERSATION...",
  trial_duration: 2500,
  choices: "NO_KEYS"
  }
  
 ], timeline_variables: CA_timeline_stimuli}

timeline.push(CA_trials)

/***** LISTENING COMPREHENSION BLOCK *********
Participants will listen to a audio dialogues in French. After the dialogues they will answer different questions:
1. Listen to a dialogue and indicate which pictures each line of the dialogue corresponds to (how to do this???) 
2. Choosing from two pictures: one picture represents information from the dialogue, and one does not. 
3. Listen to a short dialogue (twice), and then respond to written comprehension questions orally using French. There is a 30-sec
*/


/**** LC1 - Two Dialogues*******
Listen to two dialogues and choose which picture from among four pictures matches the dialogue
Each trial shows pictures, plays dialogue once, then immediately plays again, then participants make choice. 
*/

// stim for timeline variable
var LC1_timeline_stimuli = [
  {dialogue: 'audio/fiona1.mp3', data:{stim_id: 'dialogue1'}},
  {dialogue: 'audio/fiona2.mp3', data:{stim_id: 'dialogue1'}}
]

// stim for media preloading
var LC1_images = ['image/LC1_A.png','image/LC1_B.png','image/LC1_C.png','image/LC1_D.png']
var LC2_audio = ['audio/fiona.mp3']

// preload LC1 stimuli just before the trial. 
var LC1_preload = {
  type: jsPsychPreload,
  images:LC1_images,
  audio: LC2_audio
}

//timeline.push(LC1_preload)

var LC1_instructions = {
  type: jsPsychInstructions,
  pages: ['For this question you will hear <b>two</b> different dialogues, two times each.',
  'While listening to the dialogue, you will also be shown four images.',
  'Your task is to select which image corresponds to each dialogue.',
  'One image corresponds to the first dialogue, and another image corresponds to the second dialogue.',
  'Two images do not correspond to either dialogue.',
  'After listening to the dialogue, indicate you answer by clicking the corresponding button.'],
show_clickable_nav: true,
}

//timeline.push(LC1_instructions)


var LC1_trials = {
  timeline: [

  // defined above. 
  //play_audio_button,

  // this trial type is the best way to get image responses to audio. 
  // images load slightly slower than the audio, so audio needs a time buffer. 
  {type: jsPsychAudioButtonResponse,
  data: jsPsych.timelineVariable("data"),
  prompt: 'Which image best matches the dialogue?<br><img src = "image/LC1_A.png"><img src = "image/LC1_B.png"><img src = "image/LC1_C.png"><img src = "image/LC1_D.png">',
  stimulus: jsPsych.timelineVariable('dialogue'),
  //prompt: "Which image corresponds to the dialogue you just heard?",
  response_allowed_while_playing: false,
  choices: ['Image A', 'Image B', 'Image C', 'Image D']},
  
 
], timeline_variables: LC1_timeline_stimuli}

//timeline.push(LC1_trials)


/***** LC2 - messages *******
 * Participants will see two pictures. They will hear a short message play twice. They will then choose which picture matches the message.
*/

// LC2 timeline stimuli
var LC2_timeline_stimuli = [
  {message: 'audio/fiona1.mp3', image: 'image/m1_img.jpg', data:{stim_id: 'message1'}},
  {message: 'audio/torin1.mp3', image: 'image/m2_img.jpg', data:{stim_id: 'message2'}}
]

//LC2 lists for preload
var LC2_images = ['image/m1_img.jpg', 'image/m2_img.jpg']
var LC2_audio = ['audio/fiona1.mp3', 'audio/torin1.mp3']


// LC2 preload media
var LC2_preload = {
  type: jsPsychPreload,
  images: LC2_images,
  audio: LC2_audio
}

//timeline.push(LC2_preload)

var LC2_instructions = {
  type: jsPsychInstructions,
  pages: ['For this question you will hear a short message from a person.',
  'You will also be shown two images.',
  'Your task is to select which image corresponds to the speaker of the message.',
  'You will listen to the message twice before making your answer.',
  'Indicate you answer by clicking on the corresponding button.'],
show_clickable_nav: true,
}
//timeline.push(LC2_instructions)


var LC2_trials = {
  timeline: [

  // defined above
 // play_audio_button,

  {type: jsPsychAudioButtonResponse,
  on_start: function(trial){
    trial.prompt = "Which image corresponds to the message?<br><img src = ".concat(jsPsych.timelineVariable('image')).concat(">")},
  data: jsPsych.timelineVariable("data"),
  stimulus: jsPsych.timelineVariable('message'),
  response_allowed_while_playing: false,
  choices: ['Image A', 'Image B']},

  {type: jsPsychHtmlButtonResponse,
    stimulus: 'Press continue to proceed to the next question',
  choices: ["Continue"]}
], timeline_variables: LC2_timeline_stimuli
}

//timeline.push(LC2_trials)


/*LC3 - audio answers ******
* participant will hear a short monologue. It will play once, pause for 30 seconds, then play again.
* participant will also see four questions
* after the second dialogue, participants will respond orally to the four questions. 
* participants will have a maximum of 2 minutes to record their answers. 
* TWO trials like this per test
*/

// record answer trial for story completion trials
const record_answer_LC = {
    type: jsPsychHtmlAudioResponse,
    on_start: function(trial){
      trial.stimulus = 'RECORDING...<br><br><br>'.concat(jsPsych.timelineVariable('questions'))
    },
    stimulus: '',
    recording_duration: 5000,
    show_done_button: true,
    done_button_label: "Finish Recording",
    // save audio
    on_finish: function(data){
        //subject name
      purgeAudio(jsPsych.data.get().select('subject').values[0].Q0,
      // audio file name
      jsPsych.data.get().last(5).values()[0].stimulus.substring(6), 
      // current js data object
      data),
      console.log(jsPsych.data.get().last(5).values()[0].stimulus.substring(6))
}}

// LC3 stimuli for timeline
var LC3_timeline_stimuli = [{monologue: 'audio/fiona1.mp3', questions: '<ul><li>Question 1</li><li>Question2</li><li>Question3</li><li>Question 4</li></ul>', data: {stim_id: 'monologue1'}},
{monologue: 'audio/torin1.mp3', questions: '<ul><li>Question 1</li><li>Question2</li><li>Question3</li><li>Question 4</li></ul>', data: {stim_id: 'monologue1'}}]

var LC3_audio = ['audio/fiona1.mp3', 'audio/torin1.mp3']

var LC3_preload = {
  type: jsPsychPreload,
  audio: LC3_audio
}
timeline.push(LC3_preload)

var LC3_instructions = {
  type: jsPsychInstructions,
  pages: ['In the next questions you will hear a speaker talk about an event',
  'You will also see four questions (in French) about the event',
  'You will listen to the audio twice, with a 30 second break between the audio',
  'After you hear the audio for the second time, you will answer the questions by speaking in French.',
  'Please try to answer all four questions in your response. You will have up to two minutes to answer the four questions.'],
show_clickable_nav: true,
}
//timeline.push(LC3_instructions)

var LC3_trials = {
  timeline: [

  // defined above
  //play_audio_button,

  {type: jsPsychAudioKeyboardResponse, 
  prompt: jsPsych.timelineVariable('questions'),
  data: jsPsych.timelineVariable("data"),
  stimulus: jsPsych.timelineVariable('monologue'),
  trial_ends_after_audio: true,
  choices: "NO_KEYS"},
  
  // simulate a countdown for recording to start
  {type: jsPsychHtmlKeyboardResponse,
    stimulus: 'Begin speaking your answer in 3...',
    choices: 'NO_KEYS',
    trial_duration: 1050
  },
  
  // simulate a countdown for recording to start
  {type: jsPsychHtmlKeyboardResponse,
    stimulus: 'Begin speaking your answer in 2...',
    choices: 'NO_KEYS',
    trial_duration: 1050
  },
  
  // simulate a countdown for recording to start
  {type: jsPsychHtmlKeyboardResponse,
    stimulus: 'Begin speaking your answer in 1...',
    choices: 'NO_KEYS',
    trial_duration: 1050
  },
 
  // participant records response
  record_answer_LC,

  {type: jsPsychHtmlButtonResponse,
    stimulus: 'Press continue to proceed to the next question',
  choices: ["Continue"]}
], timeline_variables: LC3_timeline_stimuli
}
//timeline.push(LC3_trials)

/*LC4 - multiple guess questions ******
* participant will hear a short monologue. It will play once, pause for 30 seconds, then play again.
* participants will then answer multiple choice questions which include both text and images. 
* questions are shown while listening to the audio
*/

// LC4 stimuli for timeline
var LC4_timeline_stimuli = [
  {phone_audio: 'audio/fiona1.mp3', survey_questions: [
  {prompt: 'What is his birthday?', name: 'phone1Q1', options: ['A', 'B', 'C', 'D'], required: true, horizontal: true}, 
  {prompt: 'Which picture?', name: 'phone1Q2', options: ['<img src = image/LC4_A.png height = 200, width = 250>', '<img src = image/LC4_B.png height = 200, width = 250>'], required: true, horizontal: true},
  {prompt: 'Who will take the cake?', name: 'phone3Q3', options: ['Cat', 'Zebra', 'Kiwi'], required: true, horizontal: true}],
  question_display: 'What is his birthday? <br><br> Which picture? <br><br> Who will take the cake?', 
            data: {stim_id: 'phone1'}},

{phone_audio: 'audio/torin1.mp3', 
survey_questions: [
  {prompt: 'What is his birthday?', name: 'phone2Q1', options: ['A', 'B', 'C', 'D'], required: true, horizontal: true}, 
  {prompt: 'Which picture?', name: 'phone2Q2', options: ['<img src = image/LC4_B.png height = 200, width = 250>', '<img src = image/LC4_A.png height = 200, width = 250>'], required: true, horizontal: true},
  {prompt: 'Who will take the cake?', name: 'phone3Q3', options: ['Cat', 'Zebra', 'Kiwi'], required: true, horizontal: true}], 
  // to see questions during audio
  question_display: 'What is his birthday? <br><br> Which picture? <br><br> Who will take the cake?', 
data: {stim_id: 'phone2'}}
        
]

//var LC4_timeline_stimuli = [{phone_audio: 'audio/fiona1.mp3', question_strings:[], question_buttons: [], 
  //          data: {stim_id: 'phone1'}}]

var LC4_audio = ['audio/fiona1.mp3', 'audio/torin1.mp3']
var LC4_images = ['image/LC4_A.png', 'image/LC4_B.png']

var LC4_preload = {
  type: jsPsychPreload,
  audio: LC4_audio,
  images: LC4_images
}
//timeline.push(LC4_preload)

var LC4_instructions = {
  type: jsPsychInstructions,
  pages: ['For these next questions you will listen to a short phone message from a speaker.',
  'You will also see several multiple choice questions asking about the message.',
  'You will listen to the audio twice, with a 30 second break between the audio.',
  'After you hear the audio for the second time, please indicate your answers to the questions.'],
show_clickable_nav: true,
}
//timeline.push(LC4_instructions)

var LC4_trials = {
  timeline: [
  
  // listen to audio while seeing questions
  {type: jsPsychAudioKeyboardResponse, 
  prompt: jsPsych.timelineVariable('question_display'),
  data: jsPsych.timelineVariable("data"),
  stimulus: jsPsych.timelineVariable('phone_audio'),
  trial_ends_after_audio: true,
  choices: "NO_KEYS"},


  {type: jsPsychSurveyMultiChoice,
  questions: jsPsych.timelineVariable('survey_questions')}

  ], timeline_variables: LC4_timeline_stimuli
}

//timeline.push(LC4_trials)

/***** C-TEST *********
Participants will read three short texts. Each text will have some words missing parts of the word. Participants must type in letters in order to provide correct words. 
*/

var french_characters = 'If your keyboard does not have French accents, please use these numbers to replace the appropriate letter with the corresponding number:<br> 1 = &agrave; <br>2 = &eacute; <br>3 = &ecirc; <br>4 = &egrave;<br>Example: For the word <b>&eacute;cole</b>, please type it as <b>2cole</b><br><br>'

var CT_stim = [
    {c_text: french_characters.concat("Coucou, tu es d'accord pour m'aider &agrave; organiser l'anniversaire de Clara? Hier, no%% avons pr&eacute;%% un gr%% g&acirc;teau a%% chocolat. M%% s&oelig;urs o%% achet&eacute; d%% d&eacute;corations e%% des bon%% hier mi%%. Tu pe%% prendre d%% boissons e%% de l%% glace. L%% f&ecirc;te e%% samedi, ch%% moi.  Vi%% av%% ton co%% de fran%%, on v%% faire u%% salade d%% fruits ense%%.  Apr&egrave;s o%% va pr&eacute;p%% la mai%% et met%% de l%% musique. Appelle-moi quand tu arrives."), data: {stim_id: 'ctest_text1'}}
]

var CT_instructions = {
  type: jsPsychInstructions,
  pages:['In this part of the test you will see a text presented on the screen.',
'In the following texts, parts of some words is missing.', 
'Please write in the missing letters to complete the words.',
'You will have 5 minutes for each text.',
'Please click Continue to see the first text.'],
show_clickable_nav: true
}

//timeline.push(CT_instructions);
//https://github.com/jspsych/jsPsych/discussions/2543


var CT_trials = {
timeline:[
{type: jsPsychHtmlButtonResponse,
stimulus: 'Press "Continue" to see the text.',
choices: ['Continue'],
},

{type: jsPsychCloze,
text: jsPsych.timelineVariable('c_text'),
data: jsPsych.timelineVariable("data"),
trial_duration: 300000,
},

{type: jsPsychHtmlKeyboardResponse, // TO UPDATE AND ACTUALLY PROMPT ACTION
stimulus: 'next',
choices: [' ']}
], timeline_variables: c_test_stim
}

//timeline.push(CT_trials);


/***** ERROR CORRECTION TASK *********
Participants will see a sentence and also hear the sentence spoken one time
They will know there is an error somewhere in the sentence
Their task is to locate and correct the error

*/

EC_timeline_stimuli = [
  {sentence: 'Julian pr&eacute;pare les tomates rouge pour la salade.', 
  audio: 'audio/EC/EC1.mp3', 
  data: {stim_id: 'EC1'}
  },
  {sentence: 'Pour c&eacute;l&eacute;brer la f&ecirc;te de Paola, ils allent au restaurant.', 
  audio: 'audio/EC/EC2.mp3', 
  data: {stim_id: 'EC2'}
  },
  {sentence: 'Tu fait souvent du v&eacute;lo de montagne avec ton cousin.', 
  audio: 'audio/EC/EC3.mp3', 
  data: {stim_id: 'EC3'}
  },
  {sentence: 'David et Laurence sont lou&eacute; une chambre d\'h&ocirc;tel au centre-ville. ', 
  audio: 'audio/EC/EC4.mp3', 
  data: {stim_id: 'EC4'}
  },
  {sentence: 'Madame Zuniga habites sur le campus de l\'universit&eacute;.', 
  audio: 'audio/EC/EC5.mp3', 
  data: {stim_id: 'EC5'}
  },
  {sentence: 'Elle a trouver un ballon de foot pour l\'anniversaire de Marwan.', 
  audio: 'audio/EC/EC6.mp3', 
  data: {stim_id: 'EC6'}
  },
  {sentence: 'Ils ne trouvent pas une grande maison &agrave; Boston.  ', 
  audio: 'audio/EC/EC7.mp3', 
  data: {stim_id: 'EC7'}
  },
  {sentence: 'Je ne pas danse bien avec mes nouvelles chaussures.', 
  audio: 'audio/EC/EC8.mp3', 
  data: {stim_id: 'EC8'}
  },
  {sentence: 'Ta fr&egrave;re travaille toute la journ&eacute;e au bureau. ', 
  audio: 'audio/EC/EC9.mp3', 
  data: {stim_id: 'EC9'}
  },
  {sentence: 'Je garde le chien de le voisin chez moi. ', 
  audio: 'audio/EC/EC10.mp3', 
  data: {stim_id: 'EC10'}
  },
  {sentence: 'Nous jouons au tennis avec un raquette et une balle.', 
  audio: 'audio/EC/EC11.mp3', 
  data: {stim_id: 'EC11'}
  },
  {sentence: 'Vous finis vos devoirs avant de jouer avec vos copains!', 
  audio: 'audio/EC/EC12.mp3', 
  data: {stim_id: 'EC12'}
  },
  {sentence: 'Elisabeth aime la petit plante dans la cuisine.', 
  audio: 'audio/EC/EC13.mp3', 
  data: {stim_id: 'EC13'}
  },
  {sentence: 'Magali explique la nouvelle le&ccedil;on &agrave; les &eacute;tudiants.', 
  audio: 'audio/EC/EC14.mp3', 
  data: {stim_id: 'EC14'}
  },
  {sentence: 'J\'ai chaud. Je veut une glace au chocolat et &agrave; la vanille.', 
  audio: 'audio/EC/EC15.mp3', 
  data: {stim_id: 'EC15'}
  },
  {sentence: 'J\'adore la nouvelle professeure de fran&ccedil;ais de ton s&oelig;ur.', 
  audio: 'audio/EC/EC16.mp3', 
  data: {stim_id: 'EC16'}
  },
  {sentence: 'Les enfants de Max et Laurent grandissez tr&egrave;s rapidement.', 
  audio: 'audio/EC/EC17.mp3', 
  data: {stim_id: 'EC17'}
  },
  {sentence: 'Chaque matin, nous boire un th&eacute; sur la terrasse.', 
  audio: 'audio/EC/EC18.mp3', 
  data: {stim_id: 'EC18'}
  },
  {sentence: 'Ils avons une pizza italienne au parc.', 
  audio: 'audio/EC/EC19.mp3', 
  data: {stim_id: 'EC19'}
  },
  {sentence: 'Le weekend, on regardent la t&eacute;l&eacute;vision avec notre famille.', 
  audio: 'audio/EC/EC20.mp3', 
  data: {stim_id: 'EC20'}
  }
]

// yes this bad programming.
var EC_audio = ['audio/EC/EC1.mp3', 'audio/EC/EC2.mp3', 'audio/EC/EC3.mp3','audio/EC/EC4.mp3','audio/EC/EC5.mp3','audio/EC/EC6.mp3','audio/EC/EC7.mp3','audio/EC/EC8.mp3','audio/EC/EC9.mp3','audio/EC/EC10.mp3','audio/EC/EC11.mp3','audio/EC/EC12.mp3','audio/EC/EC13.mp3','audio/EC/EC14.mp3','audio/EC/EC15.mp3','audio/EC/EC16.mp3','audio/EC/EC17.mp3','audio/EC/EC18.mp3','audio/EC/EC19.mp3','audio/EC/EC20.mp3',]

var EC_preload = {
  type: jsPsychPreload,
  audio: EC_audio
}

timeline.push(EC_preload);

var EC_instructions = {
  type: jsPsychInstructions,
  pages: ['In this activity, you are given a sentence that contains one <b>grammatical error</b>.',
  'While the sentence remains on the screen, you will hear it once.',
  'The written sentence will then stay on the screen, and you have 2 minutes to complete each question.',
  'You must (1) identify the error, (2) correct the error, and (3) explain why it is incorrect in English.',
'Continue to see an example in English.'],
show_clickable_nav: true,
}

//timeline.push(EC_instructions);

EC_prompts = [{prompt: 'What is the error?', required: true}, 
{prompt: 'What is the correction?', required: true}, 
{prompt: 'Why is it an error?', required: true}]

EC_demo_html = '<p>What is the error? <input readonly type = "text" id = "demo_error" name = "demo_response" placeholder = "at"/></p>' +
'<p>What is the correction? <input readonly type = "text" id = "demo_correction" name = "demo_response" placeholder = "in"/></p>' +
'<p>Why is it an error? <input readonly type = "text" id = "demo_explanation" name = "demo_response" placeholder = "used the wrong preposition" size = "50"/></p>'

EC_html = '<p>What is the error? <input type = "text" name = "error"/></p><p>What is the correction? <input type = "text" name = "correction"/></p><p>Why is it an error? <input type = "text" name = "explanation" size = "50"/></p>'


var EC_demo = {
  timeline:[
  {type: jsPsychSurveyHtmlForm,
  html: EC_demo_html,
  preamble: '<i>Please follow this example when answering the questions. You may write your explanation in English. <br>Press continue when you are ready to begin.</i><br><br><br><b>I put a bottle of water at the freezer</b><br><br>'
},
{type: jsPsychHtmlButtonResponse,
  stimulus: "Fill as many boxes as you can. Do not give up!<br>Do not use online dictionaries or reference tools. We are interested in what YOU know!",
  choices:['Begin']
}
]
}

//timeline.push(EC_demo);

var EC_trials = {
  timeline:[

  {type: jsPsychHtmlButtonResponse,
    stimulus: 'Click Next to proceed to the next sentence.<br>',
    choices: ["Next"]},

  {type: jsPsychSurveyHtmlFormTO,
  data: jsPsych.timelineVariable('data'),
  on_start: function(trial){
  trial.preamble = '<audio autoplay><source src ='.concat(jsPsych.timelineVariable('audio')).concat('></audio>').concat('<b>').concat(jsPsych.timelineVariable('sentence').concat('</b><br><br>'))
  },
  html: EC_html,
  preamble: '',
  trial_duration: 120050 //duration of each question is 2 minutes +50ms buffer
  },
  
], timeline_variables: EC_timeline_stimuli
}

//timeline.push(EC_trials)




 var end = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: 'Press the spacebar to end the test',
  choices: ' '
 }
 
 timeline.push(end)
 

jsPsych.run(timeline);
</script>